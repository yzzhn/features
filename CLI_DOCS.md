# features CLI

Once you have installed this package, try typing `features` on the command line (assumes `~/local_pip/bin` is on your path, add it to your `~/.bashrc` or your shell equivalent if it is not;  Alternatively, call `python generate_features/cli.py`)

Here is a description of available commands, generated by running `features --help` or `features ls --help` or `features compute --help` etc. to get documentation on the full list of options available for each command.


## features ls

```bash
Usage: features ls [OPTIONS] [LOGTYPES]...

  List parquets that exist or are missing for given logtype(s), from a `start_time` to an `end_time`, in
  various output formats.

  Examples:
  features ls http renisac
  features ls --output_format ranges http renisac
  features ls --root_dir /scratch/jjp3n/root_dir --start_time '2019-08-07 00:00:00' --end_time '2019-10-25 00:00:00' --output_format ranges http renisac

Options:
  --root_dir PATH                 Root dir containing logs, features and feeds.
  --start_time TEXT               start time (default: "2019-08-01 00:00:00") either in "%Y-%m-%d" or in
                                  "%Y-%m-%d %H:%M:%S" format
  --end_time TEXT                 end date (default: "2020-02-10") either in "%Y-%m-%d" or in "%Y-%m-%d
                                  %H:%M:%S" format
  --output_format [paths|columns|ranges|options]
                                  print list of paths, datetime ranges (default), or CLI options that can be
                                  passed to subsequent invocations of the `features` command.
  --existing / --missing          only list existing (default) or missing features
  --help                          Show this message and exit.
```

## features topk (Deprecated)

```bash
Usage: features topk [OPTIONS] LOGTYPE SCORE_COLUMN [DISPLAY_COLUMNS]...

  Prints out the top k rows of a log as sorted by a given column.

  Example:
  feature topk --k 42 --start_time '2019-08-06 00:30:00' --end_time '2019-08-06 01:00:00' made_bayes score host
      displays the `host` and `score` fields for the top 42 rows of `made_bayes` ordered by `score.`

Options:
  --root_dir PATH    Root dir containing zeek logs, features and feeds.
  --start_time TEXT  start time (default: "2019-08-01 00:00:00") either in "%Y-%m-%d" or in "%Y-%m-%d
                     %H:%M:%S" format
  --end_time TEXT    end date (default: "2020-02-10") either in "%Y-%m-%d" or in "%Y-%m-%d %H:%M:%S" format
  --k INTEGER        the "k" in "topk"; how many topk to display
  --help             Show this message and exit.
```

## features slurm (use features schedule on Sentinel)

```bash
Usage: features slurm [OPTIONS] [LOGTYPES]...

  Schedule slurm jobs to compute and save parquets for given logtype(s), from a `start_time` to an
  `end_time`.

Options:
  --root_dir PATH            Root dir containing zeek logs, features and feeds.
  --start_time TEXT          start time (default: "2019-08-01 00:00:00") either in "%Y-%m-%d" or in "%Y-%m-%d
                             %H:%M:%S" format
  --end_time TEXT            end date (default: "2020-02-10") either in "%Y-%m-%d" or in "%Y-%m-%d %H:%M:%S"
                             format
  --save_dir TEXT            save parquets in this directory
  --pick-one-random / --all  only compute one randomly chosen parquet / compute them all
  --account TEXT             SLURM account (default: 'netsec')
  --partition TEXT           SLURM partition (default: 'pcore')
  --mock / --for-real        only print commands that would be run in separate SLURM jobs / actually run SLURM
                             jobs for real (default)
  --mem-per-cpu INTEGER      RAM allocated per cpu in Mb (default: 36000)
  --help                     Show this message and exit.
```

## features monitor-slurm

```bash
Usage: features monitor-slurm [OPTIONS] [LOGTYPES]...

  Outputs a markdown-formatted report about slurm jobs sheduled in the last few hours. Reports the status of
  each job including the error log of failed jobs.

Options:
  --root_dir PATH                 Root dir containing slurm-logs, zeek logs, features and feeds.
  --start_time TEXT               start time (default: "2019-08-01 00:00:00") either in "%Y-%m-%d" or in
                                  "%Y-%m-%d %H:%M:%S" format
  --end_time TEXT                 end date (default: "2020-02-10") either in "%Y-%m-%d" or in "%Y-%m-%d
                                  %H:%M:%S" format
  --scheduled-within-hours FLOAT  only show slurm jobs scheduled since this many hours ago (default: 1.0)
  --partition TEXT                SLURM partition (default: 'pcore')
  --prettify / --just-markdown    prettify markdown for colorized display in terminal (default: --just-
                                  markdown)
  --help                          Show this message and exit.
```

## features compute

```bash
Usage: features compute [OPTIONS] [LOGTYPES]...

  Compute and save the parquet file(s) for given logtype(s), from a `start_time` to an `end_time`.

  Example:
  features compute --save_dir /scratch/my/favorite/root --start_time "2019-08-07 02:30:00" --end_time "2019-08-07 03:30:00" made_features

Options:
  --root_dir PATH            Root dir containing zeek logs, features and feeds.
  --start_time TEXT          start time (default: "2019-08-01 00:00:00") either in "%Y-%m-%d" or in "%Y-%m-%d
                             %H:%M:%S" format
  --end_time TEXT            end date (default: "2020-02-10") either in "%Y-%m-%d" or in "%Y-%m-%d %H:%M:%S"
                             format
  --save_dir TEXT            save parquets in this directory
  --pick-one-random / --all  only compute one randomly chosen parquet / compute them all
  --help                     Show this message and exit.
```

## features info

```bash
Usage: features info [OPTIONS] [LOGTYPES]...

  Outputs a markdown-formatted documentation about available features/logtypes.

  Examples:
  features info made_url
  features info --no-dependencies made_url
  features info

Options:
  --dependencies / --no-dependencies
                                  include dependencies in logtypes
  --prettify / --just-markdown    prettify markdown for colorized display in terminal (default: --just-
                                  markdown)
  --help                          Show this message and exit.
```

